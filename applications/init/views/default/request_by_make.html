 {{extend 'page_layout.html'}}
 {{#=BEAUTIFY(response._vars)}}
 
 <div class="row-fluid">
	<div class="span6">
		{{=form.custom.begin}}
			Trim: <div>{{=form.custom.widget.trim_choices}}</div> {{#add your own ids and classes}}
			{{if form.errors['trim_choices']:}}
				<pre>{{=form.errors['trim_choices']}}</pre> {{#change to whatever element you like}}
			{{pass}}
			Colors: <div>{{=form.custom.widget.color_preference}}</div>
			{{if form.errors['color_preference']:}}
				<pre>{{=form.errors['color_preference']}}</pre>
			{{pass}}
			Zip Code: <div>{{=form.custom.widget.zip_code}}</div>
			{{if form.errors['zip_code']:}}
				<pre>{{=form.errors['zip_code']}}</pre>
			{{pass}}
			Radius: <div>{{=form.custom.widget.radius}}</div>
			{{if form.errors['radius']:}}
				<pre>{{=form.errors['radius']}}</pre>
			{{pass}}
			{{=form.custom.submit}}
		{{=form.custom.end}}
	</div>
	<div class="span6">
		{{#style_photos}}
		<div id="style_photos" class="row-fluid">
			...loading
		</div>
		{{#style_details}}
		<div class="row-fluid">
			<h3>Stats &nbsp;<i id="stats_spinner" class="fa fa-spin"></i></h3>
			<div id = "trim_stats">
				...loading
			</div>
		</div>
	</div>
 </div>
 <h3>Reviews &nbsp;<i id="reviews_spinner" class="fa fa-spin"></i></h3>
 <div id="reviews">
	...loading
 </div>
 
 <script>
 	function load_color_preference(){
		$('#ms-auction_request_color_preference').fadeTo(500, 0.2); //the new multiselect element that the multiselect plugin creates after initialization //fade out while loading ajax
		$('#auction_request_color_preference').load(
			//url
			"{{=URL('ajax','color_preference', args=[make, model, year])}}{{='/'}}"+$('#auction_request_trim_choices').val() , //and the style id needed by getStylesByMakeModelYear(make, model, year, style_id):
			//callback
			function( response, status, xhr ) {
				if ( status == "error" ) {
					var msg = "Error loading colors: ";
					$( "#error" ).html( msg + xhr.status + " " + xhr.statusText ); //TODO- implement fail element
				}
				else {
					$('#ms-auction_request_color_preference').fadeTo(250, 1.0); //fade back in
					$(this).multiSelect('refresh'); //refresh the multiselect widget because new options were loaded via ajax after the trim was changed
				}
			}
		//close load call
		);
		//display trim stats
		$('#stats_spinner').toggleClass("fa-spinner");
		$('#trim_stats').slideUp(400).load(
			"{{=URL('ajax','style_details', args=[make, model, year])}}{{='/'}}"+$('#auction_request_trim_choices').val() , //implement fail like above
			function( response, status, xhr ) {
				if ( status == "error" ) {
					var msg = "Error loading stats: ";
					$( "#error" ).html( msg + xhr.status + " " + xhr.statusText ); //TODO- implement fail element
				}
				else {
					$(this).slideDown(200); //fade back in
					$('#stats_spinner').toggleClass("fa-spinner");
				}
			}
		);
		//display reviews
		$('#reviews_spinner').toggleClass("fa-spinner");
		$('#reviews').slideUp(600).load(
			"{{=URL('ajax','reviews')}}{{='/'}}"+$('#auction_request_trim_choices').val() , //implement fail like above
			function( response, status, xhr ) {
				if ( status == "error" ) {
					var msg = "Error loading reviews: ";
					$( "#error" ).html( msg + xhr.status + " " + xhr.statusText ); //TODO- implement fail element
				}
				else {
					$(this).slideDown(300); //fade back in
					$('#reviews_spinner').toggleClass("fa-spinner");
				}
			}
		);
		// display images
		$('#style_photos').html('<img src="http://placehold.it/815x543&text=loading..."/>').load(
			"{{=URL('ajax','style_photos')}}{{='/'}}"+$('#auction_request_trim_choices').val() , //implement fail like above
			function( response, status, xhr ) {
				if ( status == "error" ) {
					var msg = "Error loading photos: ";
					$( "#error" ).html( msg + xhr.status + " " + xhr.statusText ); //TODO- implement fail element
				}
				else {
					//$('#reviews_spinner').toggleClass("fa-spinner");
				}
			}
		);
	//close main function
	}
 	$('#auction_request_trim_choices').change(load_color_preference); //change color preference options when you change trim dropdown
	$("#auction_request_color_preference").multiSelect('refresh'); //initialize multiselect
	load_color_preference(); //first ajax call based on initial trim selection //remove during testing
 </script>