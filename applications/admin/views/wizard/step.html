{{extend 'layout.html'}}
<style>
  #wizard_form {
   padding-left:20px;
  }
  #wizard_form form ul {
  list-style: none;
  }
  #wizard_form form li, #wizard_form form tr, #wizard_form form td {
  padding: 2px;
  border: 0px;
  }
  #wizard_form label {
  font-weight: bold;
  }
  #wizard_form form table {
  border-spacing: 0px;
  }
  #wizard_form input[type=text] {
  width: 300px;  
  }
  #wizard_nav {
   width: 150px;
   border-right: 1px dotted #E1E1E1;
   padding-right: 20px;   
  }
  #no_table_description {
  width:400px;
  height:100px;
  }
  #no_table_content {
  width:600px;
  height:300px;
  }

</style>
<table width="100%">
  <tr>
    <td id="wizard_nav">
      {{if not request.function=='index':}}
      <h2><a href="{{=URL('index')}}">Start over</a></h2>      
      <ul>
	<li><b>App Name:</b> {{=session.app['name']}}</li>
      </ul>
      <h2><a href="{{=URL('step1')}}">Current settings</a></h2>      
      <ul style="overflow-y: scroll; height: 200px">
	{{for key,value in session.app['params']:}}
	<li><b>{{=key}}:</b> {{=value}}</li>
	{{pass}}
      </ul>
      <h2><a href="{{=URL('step2')}}">Tables</a></h2>
      <ul>
	{{for i,table in enumerate(session.app['tables']):}}
	<li><a href="{{=URL('step3',args=i)}}">{{=table}}</a></li>
	{{pass}}
      </ul>
      <h2><a href="{{=URL('step4')}}">Pages</a></h2>
      <ul>
	{{for i,page in enumerate(session.app['pages']):}}
	<li><a href="{{=URL('step5',args=i)}}">{{=page}}</a></li>
	{{pass}}
      </ul>
      <h2><a href="{{=URL('step6')}}">Generate</a></h2>
      {{else:}}
        <h2>Start a new app</h2>
      {{pass}}
    </td>
    <td id="wizard_form">      
      {{if 'step' in request.function:}}
      <h2>Step {{=step}}</h2>
      {{if request.function!='step1':}}
      <a class="button" href="{{=URL('step' + str(int(request.function[-1])-1))}}">back</a>
      {{pass}}
      {{else:}}
      <h2>Begin</h2>
      {{pass}}
      {{if request.function in ('step1','step2','step3','step4','step5'):}}
      <a class="button" href="{{=URL('step6')}}">skip to generate</a>
      {{pass}}
      <br /><br />
      {{if request.function in ('step1','step6'):}}
      <img src="{{=LAYOUTS_APP}}/static/plugin_layouts/layouts/{{=dict(session.app['params'])['layout_theme']}}/preview.png" alt="" align="right" id="preview"/>
      {{pass}}
      {{=form}}
      <script>
	jQuery(document).ready(function(){
            var t=jQuery('#no_table_layout_theme');
	    t.change(function(){
               jQuery('#preview').attr('src','{{=LAYOUTS_APP}}/static/plugin_layouts/layouts/'+t.val()+'/preview.png');
          });
	});
      </script>
      <br/><br/>
      <div class="box">
      <h2>Instructions</h2>
      {{if request.function=='index':}}
      <ul>
	<li>Insert the name of a new app.</li>
	<li>If the app exists and was created with the wizard, you will be able to edit it, but any manual editing to the app <b>will be lost</b>.</li>
      </ul>
      {{elif request.function=='step1':}}
      <ul>
	<li>This Wizard will help you build a new web2py app.</li>	
	<li>You can create an app with a name that already exists.</li>
	<li>If you do not have an email server set email server to "logging".</li>
	<li>If you want to use Janrain Engage for login: 1) Sign up for a <a href="http://www.janrain.com/products/engage">Janrain Engage</a> account; 2) Register you hostname, domain, and obtain an api key; 3) Set Login Config above to "domain:api_key".</li>
      </ul>
      {{elif request.function=='step2':}}
      <ul>
	<li>List the names of table that you need.</li>
	<li>If you need authentication remove the table "auth_user".</li>
	<li>Press enter to create a new input row.</li>
	<li>Empty rows are ignored.</li>
	<li>Other tables for role based access control will be created automatically, and do not need to be listed.</li>
	<li>You will be able to add fields later.</li>	
      </ul>
      {{elif request.function=='step3':}}
      <ul>
	<li>List the fields for this table (do not include an id field, it is automatic), for example "name unique" or "birthday date" or "image upload" or "comments multiple" or "description wiki required"</li>
	<li>The first keyword(s) for each entry will be used to generate a name for the table field and its label. You can use spaces an other unicode characters.</li>
	<li>Keywords "string" (default), "text", "integer", "boolean", "float",, "double", "file", "date", "time", "datetime", "file", "upload" will be used to determine the field type and they will not be made part of the field name.</li>
	<li>For a reference file use a field name, followed by the name of the referenced table.</li>
	<li>Other special keywords are "required", "notnull" or "notempty", "unique". They map into equivalent validators but (at this time) should only be used with string and text types.</li>
	<li>The keywords "html" and "wiki" force a text type and set a representation for the field value as sanitized HTML and MARKMIN resepectively.</li>
	<li>string, integer and reference fields can be "multiple", i.e. multiple values will be allowed</li>
	<li>For the "auth_user" table do not add attributes to the default fields (username, first_name, last_name, password and email). They are handled automatically.</li>
	<li>Some fields will be added automatically upon creation and handled automatically: "created_by", "created_on", "modified_by", "modified_on", "active" (only active fileds can be selected).</li>
	<li>For every table "table" another table "table_archive" is create and it contants the previsous versions of each record. This is only accessible via appadmin or programmatically.</li> 
      </ul>
      {{elif request.function=='step4':}}
      <ul>
	<li>List the names of the pages you want to create.</li>
	<li>Some pages are listed automatically because they expose Create/Read/Update/Delete for each tables you have created.</li>
	<li>All pages, except "error" and those with name starting in underscore willbe listed in the menu. You will be able to edit the menu later.</li>
	<li>You should have page "index", the starting point of your app, and page "error", where web2py will redirect to in case of error.</li>
      </ul>
      {{elif request.function=='step5':}}
      <ul>
	<li>Use the markmin syntax syntax to add text to your pages.</li>
      </ul>
      {{elif request.function=='step6':}}
      <ul>
	<li>Almost done. Click on the button above to create your new app.</li>
	<li>Once done you will be able to edit it as any normal web2py app.</li>
      </ul>
      {{pass}}
      </div>
    </td>
  </tr>
</table>
